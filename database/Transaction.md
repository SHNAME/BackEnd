# **Transaction**

트랜잭션(Transaction)이란 하나 이상의 데이터베이스 작업을 묶어서 하나의 작업처럼 처리하는 단위를 말한다.
만약 작업 과정 중 하나라도 실패하면 모두 되돌리는(rollback) 과정을 거치고 모두 성공할 경우 커밋을 한다.

### **커밋**
트랜잭션이 성공적으로 끝나면, 모든 변경사항을 DB에 최종 반영하는 과정을 말한다.  
만약 어떤 데이터를 UPDATE하는 트랜잭션일 경우 커밋 후 다른 트랜잭션이 해당 데이터에 접근 할 수 있다.

### **롤백**
만약 트랜잭션 도중 예외가 하나라도 발생하면, 그동안 했던 변경사항을 모두 취소하고 태초에 상태로 되돌린다.


### 트랜잭션의 4가지 속성(ACID)
**A** - 원자성 -> 모두 성공하면 커밋하고, 하나라도 실패할 경우 전부 반영되지 않아야한다.
**C** - 일관성 ->  트랜잭셩의 작업 처리 결과가 항상 일관성이 있어야 한다. 트랜잭션이 진행되는 동안에 데이터 베이스가 변경되더라도 업데이트된 데이터베이스로 트랜잭션이 진행되는 것이 아니라, 처음에 트랜잭션을 진행 하기 위해 스냅한 데이터베이스로 진행된다.
**I** - 독립성 -> 둘 이상의 트랜잭션이 동시에 실행되고 있을 경우 어떤 하나의 트랜잭션이 다른 트랜잭션의 연산에 끼어들 수 없다는 것을 말한다.  
**D** - 지속성 -> 트랜잭션이 성공적으로 완료되었을 경우, 결과는 영구적으로 반영되어야한다. 

### 커넥션
**커넥션**이란 애플리케이션인 spring과 DB가 통신하기 위한 통로이다.  
- Spring에서 DB에 쿼리를 보내기 위해서는 커넥션 풀에서 커넥션을 빌려와야 한다.  
- DB 작업이 끝나면 빌린 커넥션을 커넥션 풀에 반납해야한다.
- 커넥션 풀의 커넥션은 일반적으로 커넥션을 만드는데 시간이 걸리기 때문에 미리 만들어준 커넥션 모음을 말한다.
    
- 트랜잭션이 실행되는 동안, 커넥션을 점유한 상태로 유지한다.
- 트랜잭션이 많아져 커넥션 풀의 커넥션을 다 사용 중이면 새로운 요청은 대기 상태가 되고 일정 이상의 시간이 지나면 Error이 발생한다.

### 락
**락**이란 하나의 트랜잭션이 DB의 데이터를 조작하는 동안 다른 트랜잭션이 해당 데이터에 접근하지 못하도록 막는 것을 말한다.  

### 락의 종류
- 공유락 : 읽기 전용 락으로 여러 트랜잭션이 읽을 수 있는 락을 말한다.
- 배타락 : 쓰기 작업 락으로 데이터 변경될 때를 말한다. 이 때는 하나의 트랜잭션만 접근 가능하다.

### 락의 특성
- 만약 A트랜잭션이 어떤 Index에 update 작업 중이면 다른 트랜잭션은 해당 데이터에 접근하지 못하고 대기 상태에 머무른다.
- 두 개 이상의 트랜잭션이 서로가 점유한 자원을 기다리면서 무한 대기에 빠지는 상태를 교착 상태라고 하는데 이 때 DB는 이를 자동으로 감지하고 하나의 트랜잭션을 강제로 롤백하여 교착 상태를 해결한다. 롤백된 트랜잭션의 경우 DeadlockException이 발생하는데  try- catch 문으로 재시도 로직을 구현하여 재시도를 해야한다.

