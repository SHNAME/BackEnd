## JWT Token
Shopping Mall Project의 로그인 기능을 JWT 기반으로 구현하기 위해 공부한 내용을 간단하게 정리하기 위해 이 글을 작성하게 되었다.

### JWT Token이란?
JWT(Json Web Token)는 JSON 객체에 인증에 필요한 정보를 담고 비밀키로 서명한 토큰으로, 인터넷 표준 인증 방식이다. 인증(Authentication)과 인가(Authorization)를 위해 사용된다.

### JWT 작동 원리
1. 사용자가 아이디와 비밀번호를 입력한 후 서버에 로그인 요청을 보낸다.  
2. 서버는 클라이언트로부터 전달받은 데이터를 확인한 뒤 비밀키를 이용해 JSON 객체를 암호화한 JWT 토큰을 발급한다.  
3. 서버는 응답 결과 헤더에 생성한 토큰을 **함께** 클라이언트에 보낸다.  
4. 클라이언트는 응답을 받은 후 로컬에 해당 토큰을 저장한다.  
5. 클라이언트는 API를 호출할 때마다 헤더에 토큰을 실어 요청 허가를 받는다.  
6. 서버는 요청을 처리하기 전 Request Header의 토큰을 확인해 사용자의 권한을 검증하고, 문제가 없으면 API 결과를 반환한다.  

### 요청 Overhead
클라이언트가 JWT 토큰을 API 요청마다 보내면 패킷 헤더에 Overhead가 발생하고, 서버도 매 요청마다 토큰의 유효성을 검사해야 하므로 비효율이 생긴다. 이러한 비효율은 HTTP 특성 때문이다. HTTP는 **Connectionless**하고 **Stateless**하다.  

#### Connectionless란?
클라이언트와 서버가 한 번 통신을 마치면 handshake로 연결된 connection이 끊어진다(연결을 계속 유지하지 않는다).

#### Stateless란?
서버는 클라이언트를 기억하지 않는다. 즉, 클라이언트가 과거에 어떤 정보를 보냈는지, 믿을 만한 클라이언트인지, 어떤 권한이 있는지 저장하지 않는다. 따라서 API 요청 시마다 신뢰할 만한 클라이언트인지 인증 과정을 처음부터 다시 거쳐야 한다.

앞서 언급했듯 인증 과정은 속도와 공간 측면 모두에서 비효율을 일으킨다. 이를 최소화하기 위해 일정 기간 재인증 없이 사용할 수 있도록 만든 것이 **Access Token**이다. JWT Token에 대한 정리를 마친 뒤, Access Token 개념을 살펴볼 것이다.

### JWT 구조
JWT Token은 Header, Payload, Signature 세 부분으로 구성된다.

#### Header
- **alg**: Signature에서 사용하는 알고리즘  
- **type**: 토큰 타입  

#### Payload
토큰 및 사용자에 대한 메타데이터
- **sub**: 토큰 제목  
- **aud**: 토큰 대상자  
- **iat**: 토큰 발급 시각  
- **exp**: 토큰 만료 시각  

#### Signature
Header와 Payload 문자열을 합친 뒤, Header에서 지정한 알고리즘으로 암호화한 값

> Header와 Payload는 Base64url로 인코딩되어 있어 누구나 디코딩할 수 있다. 그러나 Signature는 비밀키가 없으면 위조나 복호화가 불가능하므로 안전하다. **따라서 Header와 Payload에 중요한 사용자 정보를 담아서는 안 된다!**

### JWT 장단점

#### 장점
- 세션 방식과 달리 유저 정보를 서버 DB에 저장하지 않으므로 서버 용량과 무관하다.  
- 비밀키를 가진 서버만 서명을 검증할 수 있어 안전하다.  
- 특정 플랫폼에 종속적이지 않다.  
- 사용 방식이 간단하다.  

#### 단점
- 토큰 크기가 커질수록 패킷 크기가 증가해 트래픽에 영향을 줄 수 있다.  
- 토큰에 만료 기간이 있으므로 만료 처리 기능을 구현해야 한다.  
